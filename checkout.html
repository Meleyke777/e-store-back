<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout - E-commerce</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #0f172a; color: #f1f5f9; } /* dark blue theme */
    input, select { background-color: #1e293b; color: #f1f5f9; border-color: #3b82f6; }
    .bg-card { background-color: #1e293b; }
    .btn-primary { background-color: #3b82f6; color: #f1f5f9; }
    .btn-primary:hover { background-color: #2563eb; }
    .notification-container { position: fixed; top: 10px; right: 10px; z-index: 1050; }
  </style>
</head>
<body>
    <nav class="w-full nav-blur sticky top-0 z-50">
    <div class="container mx-auto px-8 py-5 flex justify-between items-center">
      <h1 class="text-2xl font-extrabold tracking-tight bg-gradient-to-r from-white to-sky-400 bg-clip-text text-transparent">
        E-STORE<span class="text-sky-500">.</span>
      </h1>
      <div class="hidden md:flex gap-10 text-sm font-medium">
        <a href="index.html" class="text-slate-400 hover:text-white transition-colors">Home</a>
        <a href="shop.html" class="text-slate-400 hover:text-white transition-colors">Shop</a>
        <a href="cart.html" class="text-slate-400 hover:text-white transition-colors">Cart</a>
        <a href="cart.html" class="text-sky-400">Cart</a>
        <a href="contact.html" class="text-slate-400 hover:text-white transition-colors">Contact</a>
      </div>
    </div>
  </nav>
  <div id="navbar-placeholder"></div>

  <!-- Login Modal -->
  <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex justify-center items-center z-50">
    <div class="bg-card rounded-lg p-6 relative w-full max-w-md">
      <button id="close-login-modal" class="absolute top-3 right-3 text-white text-2xl">&times;</button>
      <h2 class="text-xl font-bold mb-4">Login Required</h2>
      <p class="mb-4">You must be logged in to continue.</p>
      <button id="go-login-btn" class="btn-primary px-4 py-2 rounded">Go to Login</button>
    </div>
  </div>

  <div class="container mx-auto px-4 py-8">
    <div class="flex flex-col md:flex-row gap-6">
      <!-- Shipping Form -->
      <div class="w-full md:w-7/12">
        <div class="bg-card border border-gray-700 rounded-lg p-6 shadow-sm">
          <h4 class="text-xl font-semibold mb-4">Shipping Information</h4>
          <form id="shipping-form" class="space-y-4" novalidate>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="space-y-2">
                <label for="firstName" class="block text-sm font-medium">First name</label>
                <input type="text" id="firstName" placeholder="Ali" required class="w-full px-3 py-2 rounded-md" />
                <div class="text-red-500 text-sm hidden" id="firstName-error">First name is required.</div>
              </div>
              <div class="space-y-2">
                <label for="lastName" class="block text-sm font-medium">Last name</label>
                <input type="text" id="lastName" placeholder="Aliyev" required class="w-full px-3 py-2 rounded-md" />
                <div class="text-red-500 text-sm hidden" id="lastName-error">Last name is required.</div>
              </div>
            </div>
            <div class="space-y-2">
              <label for="city" class="block text-sm font-medium">City</label>
              <input type="text" id="city" placeholder="Baku" required class="w-full px-3 py-2 rounded-md" />
              <div class="text-red-500 text-sm hidden" id="city-error">City is required.</div>
            </div>
            <div class="space-y-2">
              <label for="address" class="block text-sm font-medium">Address</label>
              <input type="text" id="address" placeholder="Street, House/Apartment" required class="w-full px-3 py-2 rounded-md" />
              <div class="text-red-500 text-sm hidden" id="address-error">Address is required.</div>
            </div>
            <div class="space-y-2">
              <label for="phone" class="block text-sm font-medium">Phone</label>
              <input type="tel" id="phone" placeholder="+994 xx xxx xx xx" required class="w-full px-3 py-2 rounded-md" />
              <div class="text-red-500 text-sm hidden" id="phone-error">Phone number is required.</div>
            </div>
            <div class="flex items-start">
              <div class="flex items-center h-5">
                <input type="checkbox" id="termsCheck" class="w-4 h-4 text-blue-600 rounded" required />
              </div>
              <div class="ml-3 text-sm">
                <label for="termsCheck" class="font-medium">I agree to the terms and conditions</label>
                <div class="text-red-500 text-sm hidden" id="terms-error">You must agree before submitting.</div>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Payment Form -->
      <div class="w-full md:w-5/12 space-y-6">
        <div class="bg-card border border-gray-700 rounded-lg p-6 shadow-sm">
          <h4 class="text-xl font-semibold mb-4">Payment</h4>
          <form id="payment-form" class="space-y-4" novalidate>
            <div class="space-y-2">
              <label for="cardNumber" class="block text-sm font-medium">Card number</label>
              <input type="text" id="cardNumber" placeholder="4543 xxxx xxxx xxxx" required class="w-full px-3 py-2 rounded-md" />
              <div class="text-red-500 text-sm hidden" id="cardNumber-error">Valid card number is required.</div>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div class="space-y-2">
                <label for="expMonth" class="block text-sm font-medium">Expiration (MM)</label>
                <input type="text" id="expMonth" placeholder="MM" required class="w-full px-3 py-2 rounded-md" />
                <div class="text-red-500 text-sm hidden" id="expMonth-error">Valid month required.</div>
              </div>
              <div class="space-y-2">
                <label for="expYear" class="block text-sm font-medium">Expiration (YY)</label>
                <input type="text" id="expYear" placeholder="YY" required class="w-full px-3 py-2 rounded-md" />
                <div class="text-red-500 text-sm hidden" id="expYear-error">Valid year required.</div>
              </div>
            </div>
            <div class="space-y-2">
              <label for="cvc" class="block text-sm font-medium">Card security code</label>
              <input type="text" id="cvc" placeholder="CVC" required class="w-full px-3 py-2 rounded-md" />
              <div class="text-red-500 text-sm hidden" id="cvc-error">CVC is required.</div>
            </div>
          </form>

          <!-- Order Summary -->
          <div class="bg-card border border-gray-700 rounded-lg p-6 mt-4 shadow-sm">
            <h5 class="text-lg font-semibold mb-4">Order Summary</h5>
            <div class="space-y-2">
              <div class="flex justify-between"><span>Subtotal</span><span id="subtotal">0 ₼</span></div>
              <div class="flex justify-between"><span>Shipping</span><span>Free</span></div>
              <hr class="my-2 border-gray-600" />
              <div class="flex justify-between font-bold"><span>Total</span><span id="total">0 ₼</span></div>
            </div>
            <button id="placeOrderBtn" class="btn-primary w-full py-2 px-4 rounded mt-4">Place order</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="notification-container">
    <div id="success-alert" class="bg-green-500 text-white px-4 py-3 rounded shadow-md flex justify-between items-center transform transition-transform duration-300 scale-0">
      <div>Order placed successfully! Redirecting to homepage...</div>
      <button type="button" class="focus:outline-none" onclick="closeNotification()"><span class="text-2xl">&times;</span></button>
    </div>
  </div>

<script src="api.js"></script>
<script src="create-product.js"></script>
<script src="my-products.js"></script>
<script src="shop.js"></script>

  <script>document.addEventListener("DOMContentLoaded", () => {
  const cartItems = JSON.parse(localStorage.getItem("cartItems") || "[]");
  const subtotal = localStorage.getItem("cartSubtotal") || "0.00";
  
  const subtotalEl = document.getElementById("subtotal");
  const totalEl = document.getElementById("total");
  const placeOrderBtn = document.getElementById("placeOrderBtn");

  // Populate Summary
  if (subtotalEl) subtotalEl.textContent = `${subtotal} ₼`;
  if (totalEl) totalEl.textContent = `${subtotal} ₼`;

  placeOrderBtn.addEventListener("click", async (e) => {
    e.preventDefault();
    const token = localStorage.getItem("authToken");
    
    if (!token) return alert("Please log in again.");
    if (cartItems.length === 0) return alert("Your cart is empty!");

    const order = {
      items: cartItems.map(item => ({ productId: item.id, qty: item.qty })),
      firstName: document.getElementById("firstName").value,
      lastName: document.getElementById("lastName").value,
      city: document.getElementById("city").value,
      address: document.getElementById("address").value,
      phone: document.getElementById("phone").value,
      totalAmount: parseFloat(subtotal)
    };

    try {
      const res = await fetch(`${API_BASE}/orders`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify(order)
      });

      if (!res.ok) throw new Error();

      // Success UI
      const alertBox = document.getElementById("success-alert");
      alertBox.classList.remove("scale-0");
      
      localStorage.removeItem("cartItems");
      localStorage.removeItem("cartSubtotal");

      setTimeout(() => {
        window.location.href = "/"; 
      }, 2500);

    } catch (err) {
      alert("Checkout failed. Please try again.");
    }
  });
});

 
  </script>
</body>
</html>
